<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kỷ yếu</title>
<link rel="stylesheet" href="css/main.css">
</head>

<body>

<audio id="bgm" src="bg.mp3" loop></audio>
<div id="app"></div>

<script>
const app = document.getElementById("app");
const bgm = document.getElementById("bgm");

let loadedScripts = [];

async function loadPage(page){
  // XOÁ TOÀN BỘ SCRIPT CŨ
  loadedScripts.forEach(s => s.remove());
  loadedScripts = [];

  const res = await fetch("pages/" + page + "?v=" + Date.now());
  const html = await res.text();

  app.innerHTML = html;

  const scripts = app.querySelectorAll("script");

  for(const old of scripts){
    const s = document.createElement("script");
    if(old.src){
      s.src = old.src + "?v=" + Date.now();
    } else {
      s.textContent = old.textContent;
    }
    document.body.appendChild(s);
    loadedScripts.push(s);
  }

  window.scrollTo(0,0);
}

window.go = page => loadPage(page);

loadPage("intro.html");

document.addEventListener("click",()=>{
  if(bgm.paused) bgm.play().catch(()=>{})
},{once:true});
</script>

</body>
</html>
