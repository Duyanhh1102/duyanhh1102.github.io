<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Kỷ yếu</title>

  <link rel="stylesheet" href="css/main.css">
</head>
<body>

  <!-- Nhạc nền -->
  <audio id="bgm" src="bg.mp3" loop></audio>

  <!-- Khung load trang -->
  <div id="app"></div>

  <script>
    const app = document.getElementById("app");
    const bgm = document.getElementById("bgm");

    async function loadPage(page) {
      try {
        const res = await fetch("pages/" + page + "?v=" + Date.now());
        const html = await res.text();
        app.innerHTML = html;

        // ÉP SCRIPT TRONG FILE CON CHẠY LẠI (FIX LỖI KHÔNG HIỆN THƯ + KHÔNG CHẠY JS)
        app.querySelectorAll("script").forEach(oldScript => {
          const newScript = document.createElement("script");
          if (oldScript.src) {
            newScript.src = oldScript.src;
          } else {
            newScript.textContent = oldScript.textContent;
          }
          document.body.appendChild(newScript);
          oldScript.remove();
        });

        window.scrollTo(0, 0);
      } catch (err) {
        app.innerHTML = "<h3 style='color:red;text-align:center'>Lỗi tải trang</h3>";
      }
    }

    // Load trang đầu
    loadPage("intro.html");

    // Cho phép các file con gọi chuyển trang
    window.go = function(page) {
      loadPage(page);
    }

    // Fix iOS autoplay nhạc
    document.addEventListener("click", () => {
      if (bgm.paused) {
        bgm.play().catch(()=>{});
      }
    }, { once: true });
  </script>

  <script src="js/main.js"></script>

</body>
</html>
