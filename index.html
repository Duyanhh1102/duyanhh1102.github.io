<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kỷ yếu</title>
<link rel="stylesheet" href="css/main.css">
</head>

<body>

<audio id="bgm" src="bg.mp3" loop></audio>
<div id="app"></div>

<script>
const app = document.getElementById("app");
const bgm = document.getElementById("bgm");

async function loadPage(page){
  const res = await fetch("pages/" + page + "?v=" + Date.now());
  const html = await res.text();

  app.innerHTML = html;

  // FIX CHUẨN: chạy script đúng cách – KHÔNG NHÂN BẢN
  app.querySelectorAll("script").forEach(old => {
    const s = document.createElement("script");
    if(old.src){
      s.src = old.src + "?v=" + Date.now();
    } else {
      s.textContent = old.textContent;
    }
    old.replaceWith(s); // thay thế trực tiếp → không tạo script rác
  });

  window.scrollTo(0,0);
}

window.go = page => loadPage(page);

loadPage("intro.html");

document.addEventListener("click",()=>{
  if(bgm.paused) bgm.play().catch(()=>{})
},{once:true});
</script>

</body>
</html>
